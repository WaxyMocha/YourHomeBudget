<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/index.js | YourHomeBudget</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-crWin">crWin</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-log">log</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-now">now</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send">send</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backend">backend</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send">send</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-directory">directory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-progDir">progDir</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-read">read</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-write">write</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-checkArg">checkArg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-jsonParser">jsonParser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-appRoot">appRoot</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-filesPath">filesPath</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-app">app</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-electron">electron</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-fs">fs</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ipcRenderer">ipcRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-mkdirp">mkdirp</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-os">os</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-path">path</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-platform">platform</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-readline">readline</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-remote">remote</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#frontend">frontend</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send">send</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addIncome">addIncome</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-checkArg">checkArg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-saveAll">saveAll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-budget">budget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-config">config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-incomes">incomes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-month">month</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-outcomes">outcomes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-app">app</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-electron">electron</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-electronTitlebar">electronTitlebar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ipcRenderer">ipcRenderer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-remote">remote</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-mainMenu">mainMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-menuButton">menuButton</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/index.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*jshint esversion: 6 */
/**
 * @ignore
 */
const electron = require(&apos;electron&apos;);
/**
 * @ignore
 */
const app = electron.app;
/**
 * @ignore
 */
const BrowserWindow = electron.BrowserWindow;
/**
 * @ignore
 */
const ipcMain = electron.ipcMain;
/**
 * @ignore
 */
const path = require(&apos;path&apos;);
/**
 * @ignore
 */
const url = require(&apos;url&apos;);
/**
 * @ignore
 */
let mainWin;
/**
 * @ignore
 */
let splash;
/**
 * @ignore
 */
let backendWin;
/**
 * @ignore
 */
let backendWC;

/**
 * Main function, called at startup (Main process)
 * @ignore
 */
function main() {
  require(&apos;events&apos;).EventEmitter.prototype._maxListeners = 30;
  createSplash();
  createMainWindow();
  createWorker();
}

/**
 * Returns current date and time (Main process)
 * @return {string} current date and time (dd-mm-yyyy hh:mm:ss)
 */
function now() {
  let date = new Date();
  let hr = String(&apos;0&apos; + date.getHours()).slice(-2);
  let min = String(&apos;0&apos; + date.getMinutes()).slice(-2);
  let sec = String(&apos;0&apos; + date.getSeconds()).slice(-2);
  let yr = date.getFullYear();
  let mth = String(&apos;0&apos; + String(Number(date.getMonth()) + 1)).slice(-2);
  let day = String(&apos;0&apos; + date.getDate()).slice(-2);
  let ret =  `${day}-${mth}-${yr} ${hr}:${min}:${sec}`;
  return ret;
}

/**
 * Logs in console current date and time followed by message (Main process)
 * @param {string} msg message to log in console
 * @example &lt;JavaScript&gt;
 * log(&apos;example message&apos;);
 * @example Console
 * [dd-mm-yyyy hh:mm:ss]&gt; example message
 */
function log(msg) {
  console.log(`[${now()}]&gt; ${msg}`);
}

/**
 * Create new browser window (Main process)
 * @param {undefined} win Variable which will contain BrowserWindow object
 * @param {string} htmlFile Relative path to file to load
 * @param {boolean} frame Specifies whether the window frame is displayed
 * @param {string} icon Relative path to icon for a window
 * @param {boolean} devTools Specifies whether the developer tools are displayed when the window is opened
 * @param {number} width Width of a window
 * @param {number} height Height of a window
 * @param {string} name Name of a window
 * @return {object} Object containing opened window
 * @example &lt;JavaScript&gt;
 * crWin(mainWindow, &apos;index.html&apos;, true, &apos;res/icon.ico&apos;, false, 800, 600, &apos;Main Window&apos;)
 */
function crWin(win, htmlFile, frame, icon, devTools, width, height, name) {
  // Create the browser window.
  win = new BrowserWindow({
    width: width,
    height: height,
    show: false,
    frame: frame,
    icon: __dirname + icon,
    webPreferences: { experimentalFeatures: true },
    autoHideMenuBar: true,
  });

  log(`creating ${name}`);
  log(`loading ${htmlFile} to ${name}`);

  win.loadURL(url.format({
    pathname: path.join(__dirname, htmlFile),
    protocol: &apos;file:&apos;,
    slashes: true,
  }));

  // Open the DevTools.
  if (devTools) {
    win.webContents.openDevTools();
  }

  return win;
}

log(&apos;launching&apos;);

/**
 * @ignore
 */
function createWorker() {
  let name = &apos;backendWin&apos;;
  let html = &apos;backend.html&apos;;
  backendWin = crWin(backendWin, html, true, &apos;./../res/ico/wallet.png&apos;, true, 800, 600, name);

  backendWin.on(&apos;closed&apos;, () =&gt; {
    log(&apos;closing backend window&apos;);
    backendWin = null;
    if (mainWin != null) {
      createWorker();
    }
  });

  backendWin.once(&apos;ready-to-show&apos;, () =&gt; {
      backendWin.show();
      log(&apos;showing Worker window&apos;);
    });
}

/**
 * @ignore
 */
function createMainWindow() {
  // Create the browser window.
  let name = &apos;MainWin&apos;;
  mainWin = crWin(mainWin, &apos;index.html&apos;, false, &apos;./../res/ico/wallet.png&apos;, true, 800, 600, name);
  mainWin.on(&apos;closed&apos;, () =&gt; {

    log(&apos;closing main window&apos;);
    mainWin = null;
    backendWin.close();
  });

  mainWin.once(&apos;ready-to-show&apos;, () =&gt; {
      mainWin.show();

      log(&apos;showing main window&apos;);

      splash.close();
    });
}

/**
 * @ignore
 */
function createSplash() {
  // Create the browser window.
  let nameSp = &apos;splash&apos;;
  splash = crWin(splash, &apos;loading.html&apos;, false, &apos;./../res/ico/wallet.png&apos;, false, 250, 300, nameSp);

  // Emitted when the window is closed.
  splash.on(&apos;closed&apos;, () =&gt; {

    log(&apos;closing splash screen&apos;);
    splash = null;
  });

  splash.on(&apos;ready-to-show&apos;, () =&gt; {
      log(&apos;showing splash screen&apos;);
      splash.show();
    });
}

app.on(&apos;ready&apos;, main);

// Quit when all windows are closed.
app.on(&apos;window-all-closed&apos;, () =&gt; {

  log(&apos;closing app&apos;);

  // On macOS it is common for applications and their menu bar
  // to stay active until the user quits explicitly with Cmd + Q
  if (process.platform !== &apos;darwin&apos;) {
    app.quit();
  }
});

app.on(&apos;activate&apos;, () =&gt; {
  // On macOS it&apos;s common to re-create a window in the app when the
  // dock icon is clicked and there are no other windows open.
  if (win === null) {
    createWindow();
  }
});

/**
 * Sends data to Browser Window (Main process)
 * @param {object} to Specifies destination of data (BrowserWindow object)
 * @param data Contains data to send
 * @example &lt;JavaScript&gt;
 * send(mainWin, &apos;data&apos;);
 */
function send(to, data) {
  let ch;
  if (to == backendWin) {
    ch = &apos;manipulatedData&apos;;
  } else if (to == mainWin) {
    ch = &apos;user-data&apos;;
  } else {
    return &apos;illegal channel&apos;;
  }

  to.webContents.send(ch, data);
}

ipcMain.on(&apos;manipulatedData&apos;, (e, arg) =&gt; {
  log(&apos;Odebrano (backend): &apos;);
  console.log(arg);
  console.log(&apos;&apos;);
  send(mainWin, arg);
});

ipcMain.on(&apos;user-data&apos;, (e, arg) =&gt; {
  log(&apos;Odebrano (main): &apos;);
  console.log(arg);
  console.log(&apos;&apos;);
  send(backendWin, arg);
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.3)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
