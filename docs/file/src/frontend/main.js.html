<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/frontend/main.js | YourHomeBudget</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Simple home budget manager"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="YourHomeBudget"><meta property="twitter:description" content="Simple home budget manager"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#backend">backend</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send">send</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-directory">directory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-read">read</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-write">write</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-checkArg">checkArg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-jsonParser">jsonParser</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#frontend">frontend</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-read">read</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-save">save</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-send">send</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-changeLang">changeLang</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-addIncome">addIncome</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-checkArg">checkArg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-checkMonth">checkMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-delIncome">delIncome</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-fullDateAndHour">fullDateAndHour</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-lastMth">lastMth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadMonth">loadMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-monthYear">monthYear</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-resetMonthToDefault">resetMonthToDefault</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-saveAll">saveAll</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-saveBudget">saveBudget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-saveConfig">saveConfig</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-showMonth">showMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-updateMonth">updateMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-contextIncomesAmount">contextIncomesAmount</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-contextIncomesDate">contextIncomesDate</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-delForm">delForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateContextButtons">generateContextButtons</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateHistory">generateHistory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateIncomesForm">generateIncomesForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateMainMenu">generateMainMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateOutcomesForm">generateOutcomesForm</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generatePreferences">generatePreferences</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-menuPos">menuPos</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-refreshIncomes">refreshIncomes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-incomesCategories">incomesCategories</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-lang">lang</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-budget">budget</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-config">config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-editMonth">editMonth</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-historyCheck">historyCheck</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-inOut">inOut</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-incomes">incomes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-month">month</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-outcomes">outcomes</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/frontend/main.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* jshint esversion: 6 */
/**
 * @type {object}
 * @desc Contains configuration (frontend)
 */
let config = {
  lastBudgetID: 0,
  currencySymbol: &apos;$&apos;,
};
/**
 * @type {array}
 * @desc Contains informations about incomes (frontend)
 */
let incomes = [];
/**
 * @type {array}
 * @desc Contains informations about outcomes (frontend)
 */
let outcomes = [];
/**
 * @type {object}
 * @desc Contains informations about budget (frontend)
 */
let budget = {
  id: 0,
  place: &apos;disk&apos;,
  monthsID: [{
    amount: 0,
    date: new Date(),
  },
 ],
  lastMonthID: 0,
};

let inOut = 0;
/**
 * @type {object}
 * @desc Contains informations about settlement period (frontend)
 */
let month = {
  amount: 0,
  id: 0,
  name: &apos;&apos;,
  descr: &apos;&apos;,
};

let editMonth = true;
let historyCheck = false;

/**
 * Saves all informations about budget and config (frontend)
 */
function saveAll() {
  saveConfig();
  saveBudget();
  updateMonth();
}

function saveConfig() {
  send({
    task: &apos;save&apos;,
    data: {
      name: &apos;config&apos;,
      data: config
    },
    path: &apos;&apos;,
    name: &apos;config.json&apos;,
  });
}

function saveBudget() {
  send({
    task: &apos;save&apos;,
    data: {
      name: &apos;budget&apos;,
      data: budget
    },
    path: `budgets/budget-${budget.id}/`,
    name: &apos;budget.json&apos;,
  });
}

function lastMth() {
  budget.lastMonthID = budget.monthsID.length - 1;
  loadMonth(budget.monthsID.length - 1);
  historyCheck = false;
  editMonth = true;
}

function checkMonth() {
  if (historyCheck) {
    return;
  } else {
    let lastMonth = new Date((
      budget.monthsID[budget.monthsID.length - 1].date));
    let now = new Date();
    if (now.getMonth() &gt; lastMonth.getMonth()) {
      let leftAmount = month.amount;
      resetMonthToDefault();
      budget.monthsID.push({
        date: new Date(),
      });
      budget.lastMonthID = budget.monthsID.length - 1;
      updateMonth();
      addIncome(&apos;income&apos;, &apos;bwlflm&apos;, &apos;bwlflm&apos;, leftAmount);
      saveAll();
      updateMonth();
      refreshIncomes();
    }
    saveAll();
    return;
  }
}

function resetMonthToDefault() {
  month = {
    amount: 0,
    id: 0,
    name: &apos;&apos;,
    descr: &apos;&apos;,
  };
  outcomes = [];
  incomes = [];
  return;
}

function updateMonth() {
  let amount = 0;
  let i;
  for (i = 0; i &lt; incomes.length; i++) {
    amount += Number(incomes[i].amount);
  }
  for (i = 0; i &lt; outcomes.length; i++) {
    amount -= Number(outcomes[i].amount);
  }
  month.amount = amount;
  budget.monthsID[budget.monthsID.length - 1].amount = amount;

  save({
    name: &apos;month&apos;,
    data: month
  }, &apos;month.json&apos;, `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`);

  save({
    name: &apos;incomes&apos;,
    data: incomes
  }, &apos;incomes.json&apos;, `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`);

  save({
    name: &apos;outcomes&apos;,
    data: outcomes
  }, &apos;outcomes.json&apos;, `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`);
}

function monthYear(date = new Date()) {
  date = new Date(date);
  let dateFormatted = `${date.getMonth() + 1}-${date.getYear() + 1900}`;
  return dateFormatted;
}

/**
 * Checks argument sended from backend (frontend window)
 * @param {object} arg argument from communication channel to check
 */
function checkArg(arg) {

  if (arg == &apos;start&apos;) {
    startup();
  } else if (arg == &apos;firstStartup&apos;) {
    saveAll();
    return;
  } else if (typeof arg == &apos;object&apos; &amp;&amp; arg.task == &apos;read&apos;) {
    let name = arg.data.name;
    let data = arg.data.data;
    if (name == &apos;budget&apos;) {
      budget = data;
      startup(&apos;month&apos;);
    } else if (name == &apos;month&apos;) {
      month = data;
      startup(&apos;incomes&apos;);
      startup(&apos;outcomes&apos;);
    } else if (name == &apos;incomes&apos;) {
      incomes = data;
      refreshIncomes();
      inOut++;
      if (inOut &gt;= 2) {
        checkMonth();
        inOut = 0;
      }
    } else if (name == &apos;outcomes&apos;) {
      outcomes = data;
      refreshIncomes();
      inOut++;
      if (inOut &gt;= 2) {
        checkMonth();
        inOut = 0;
      }
    } else if (name == &apos;config&apos;) {
      config = data;
      startup(&apos;budget&apos;);
    } else if (name == &apos;lang&apos;) {
      changeLang(data);
    } else {
      console.log(&apos;invalid name&apos;);
    }
  }
}


/**
 * @ignore
 * @param {string} arg Determines what needs to be loaded (called by checkArg) (frontend window)
 */
function startup(arg) {

  if (arg == &apos;config&apos; || arg == undefined) {
    send({
      task: &apos;read&apos;,
      path: &apos;&apos;,
      name: &apos;config.json&apos;,
    });
  } else if (arg == &apos;budget&apos;) {
    send({
      task: &apos;read&apos;,
      path: `budgets/budget-${config.lastBudgetID}/`,
      name: &apos;budget.json&apos;,
    });
  } else if (arg == &apos;month&apos;) {
    send({
      task: &apos;read&apos;,
      path: `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`,
      name: &apos;month.json&apos;,
    });
  } else if (arg == &apos;incomes&apos;) {
    send({
      task: &apos;read&apos;,
      path: `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`,
      name: &apos;incomes.json&apos;,
    });
  } else if (arg == &apos;outcomes&apos;) {
    send({
      task: &apos;read&apos;,
      path: `budgets/budget-${budget.id}/month-${budget.lastMonthID}/`,
      name: &apos;outcomes.json&apos;,
    });
  }

}

function fullDateAndHour(date = new Date()) {
  date = new Date(date);
  let hr = String(&apos;0&apos; + date.getHours()).slice(-2);
  let min = String(&apos;0&apos; + date.getMinutes()).slice(-2);
  let sec = String(&apos;0&apos; + date.getSeconds()).slice(-2);
  let yr = date.getFullYear();
  let mth = String(&apos;0&apos; + String(Number(date.getMonth()) + 1)).slice(-2);
  let day = String(&apos;0&apos; + date.getDate()).slice(-2);
  let ret = `${day}-${mth}-${yr} ${hr}:${min}:${sec}`;
  return ret;
}

function loadMonth(id) {
  budget.lastMonthID = id;
  read(&apos;month.json&apos;, `budgets/budget-${budget.id}/month-${id}/`);
  read(&apos;incomes.json&apos;, `budgets/budget-${budget.id}/month-${id}/`);
  read(&apos;outcomes.json&apos;, `budgets/budget-${budget.id}/month-${id}/`);
  if (id != budget.monthsID.length - 1) {
    editMonth = false;
  } else {
    editMonth = true;
  }
}

function showMonth(id) {
  if (id != budget.monthsID.length - 1) {
    historyCheck = true;
  } else {
    historyCheck = false;
  }
  loadMonth(id);
}

function delIncome(type, id) {
  let tempArr = [];
  if (!confirm(&apos;Are you shure?&apos;)) {
    return;
  }
  if (type == &apos;income&apos;) {

    for (let i = 0; i &lt; incomes.length; i++) {
      if (i != id) {
        tempArr.push(incomes[i]);
      }
    }
    incomes = tempArr;
  } else if (type == &apos;outcome&apos;) {
    for (let i = 0; i &lt; outcomes.length; i++) {
      if (i != id) {
        tempArr.push(outcomes[i]);
      }
    }
    outcomes = tempArr;
  }
  updateMonth();
  saveAll();
  refreshIncomes();
  contextIncomesAmount();
}

/**
 * Add an income or an outcome
 * @param {string} type income or outcome
 * @param {string} name Name / title of income or outcome
 * @param {string} desc Description of income or outcome
 * @param {number} amount Value of income or outcome
 * @param {number} cat Id of category
 * @example &lt;JavaScript&gt;
 * addIncome(&apos;income&apos;, &apos;Payment&apos;, &apos;From my employer&apos;, 2000, 1);
 */
function addIncome(type, name, desc, amount, cat, canDelete) {
  if (!editMonth) {
    delForm();
    if (type == &apos;income&apos;) {
      incomesCancel = undefined;
      incomesSubmit = undefined;
    } else if (type == &apos;outcome&apos;) {
      outcomesCancel = undefined;
      outcomesSubmit = undefined;
    }
    alert(&quot;You can&apos;t edit this month&quot;);
    return;
  }
  let tmpArr;
  if (type == &apos;income&apos;) {
    tmpArr = incomes;
  } else if (type == &apos;outcome&apos;) {
    tmpArr = outcomes;
  } else {
    console.log(&apos;Invalid type&apos;);
    return;
  }

  let tmpObj = {
    amount: amount,
    name: name,
    description: desc,
    cat: cat,
    date: new Date(),
    id: (tmpArr.length),
    flags: {
      del: false,
    },
  };
  if (canDelete) {
    tmpObj.flags.del = true;
  }

  tmpArr.push(tmpObj);
  updateMonth();
  refreshIncomes();
}

if ((document.getElementById(&apos;&apos;)) !== null) {
  send({
    task: &apos;&apos;
  });
}

send(&apos;reset&apos;);
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.0.4)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
